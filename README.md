# TODOs

TODO 1.

Аутентификационные куки реализованы через ClaimsIdentity;

TODO 2.

Не самое изящное решение: просто устанавливаю StatusCode, если не был найден пользователь.

TODO 3.

Получаю ExternalId из ClaimsPrincipal.

TODO 4.

Не смог аналитически найти, где может происходить рассинхрон.

Возможно, дело было во внедрении AccountService. 

TODO 5.

Проблема была в том, что контроллер, по семантике, был API, но не был указан атрибут ApiController.

Поэтому, выполнялся стандартный сценарий при попытке доступа к защищённому ресурсу без прав доступа:

Редирект на страницу LogIn.

А т.к. такой страницы в проекте нет, то возвращался 404 NotFound.

Я не стал вешать ApiController атрибут -- меня смутила информация в сети, что он всегда корректно работает.

В StartUp в определении аутентификации указал, что при событии OnRedirectToLogin:

Если относительный URL начинается с api:
 
1. Не переадресовывать.
2. Установить StatusCode 404

Исходил из предположения, что любой функционал по адресу api/... не предполагает переадресацию.

TODO 6.

Так как были реализованы Claims, включая роли, можно повесить атрибут [Authorize(Roles = "Admin")].

TODO 7.

Я не смог поймать этот баг, и аналитически выявить тоже не смог.

Возможно, дело было во внедрении AccountService.

